{% extends "base.html" %}
{% load static %}

{# Page-specific SEO: custom title + meta tags #}

{% block title %}
<title>QuickFlicks | My Shelf</title>
{% endblock %}

{% block meta_description %}
<meta name="description" content="View and manage your personal QuickFlicks shelves: To Put Away, To Watch, and Watched. Move, rate, and organise all your saved movies.">
{% endblock %}

{% block meta_keywords %}
<meta name="keywords" content="my shelf, movie shelves, to watch list, watched movies, organise films, quickflicks shelf">
{% endblock %}

{% block content %}

<!-- Back to Home/Search link -->
<a href="{% url 'home' %}"
   class="text-light ms-4"
   aria-label="Return to the movie search page">
    ‚Üê Back to Search
</a>

<div class="container py-4" role="region" aria-label="Your movie shelves">

    <!-- ========== TO PUT AWAY ========== -->
    <div class="accordion-item open"
         aria-labelledby="to-put-away-header">

        <!-- Accordion Header -->
        <button class="accordion-header"
                id="to-put-away-header"
                role="button"
                aria-expanded="true"
                aria-controls="to-put-away-content"
                tabindex="0">
            üì¶ To Put Away
        </button>

        <div class="accordion-content"
             id="to-put-away-content"
             role="region"
             aria-labelledby="to-put-away-header">

            <div class="shelf-wrapper" role="list" aria-label="Movies to put away">

                <div class="scroll-left" aria-hidden="true"></div>

                <div class="shelf-row">
                    {% for movie in to_put_away %}
                    <div class="shelf-card" role="listitem" aria-label="Movie card">
                        <img 
                            src="{{ movie.poster_url|default:'' }}" 
                            onerror="this.src='{% static 'images/movie-poster-unavailable.jpg' %}'" 
                            alt="{{ movie.title }} poster">

                        <div class="shelf-title" aria-label="Movie title: {{ movie.title }}">
                            {{ movie.title }}
                        </div>

                        <div class="shelf-actions" aria-label="Shelf actions for {{ movie.title }}">

                            <form action="{% url 'change_status' movie.id 'to_watch' %}" method="post"
                                  aria-label="Move {{ movie.title }} to your To Watch shelf">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline w-100">üéØ To Watch</button>
                            </form>

                            <form action="{% url 'change_status' movie.id 'watched' %}" method="post"
                                  aria-label="Mark {{ movie.title }} as Watched">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline w-100">‚úÖ Watched</button>
                            </form>

                            <form action="{% url 'remove_movie' movie.id %}" method="post"
                                  aria-label="Remove {{ movie.title }} from your shelf">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-danger w-100">üóëÔ∏è Remove</button>
                            </form>
                        </div>
                    </div>

                    {% empty %}
                    <div class="empty-shelf-message" role="note">
                        üì¶ Nothing to put away yet.<br>
                        Add movies from search!
                    </div>
                    {% endfor %}
                </div>

                <div class="scroll-right" aria-hidden="true"></div>
            </div>
        </div>
    </div>

    <!-- ========== TO WATCH ========== -->
    <div class="accordion-item open"
         aria-labelledby="to-watch-header">

        <!-- Accordion Header -->
        <button class="accordion-header"
                id="to-watch-header"
                role="button"
                aria-expanded="true"
                aria-controls="to-watch-content"
                tabindex="0">
            üé¨ To Watch
        </button>

        <div class="accordion-content"
             id="to-watch-content"
             role="region"
             aria-labelledby="to-watch-header">

            <div class="shelf-wrapper" role="list" aria-label="Movies to watch">

                <div class="scroll-left" aria-hidden="true"></div>

                <div class="shelf-row">
                    {% for movie in to_watch %}
                    <div class="shelf-card" role="listitem">

                        <img 
                            src="{{ movie.poster_url|default:'' }}" 
                            onerror="this.src='{% static 'images/movie-poster-unavailable.jpg' %}'" 
                            alt="{{ movie.title }} poster">

                        <div class="shelf-title" aria-label="Movie title: {{ movie.title }}">
                            {{ movie.title }}
                        </div>

                        <div class="shelf-actions" aria-label="Actions for {{ movie.title }}">

                            <form action="{% url 'change_status' movie.id 'watched' %}" method="post"
                                  aria-label="Mark {{ movie.title }} as Watched">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline w-100">‚úÖ Watched</button>
                            </form>

                            <form action="{% url 'remove_movie' movie.id %}" method="post"
                                  aria-label="Remove {{ movie.title }} from your shelf">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-danger w-100">üóëÔ∏è Remove</button>
                            </form>
                        </div>
                    </div>

                    {% empty %}
                    <div class="empty-shelf-message" role="note">
                        üéØ Your To Watch shelf is empty.<br>
                        Add something to enjoy later!
                    </div>
                    {% endfor %}
                </div>

                <div class="scroll-right" aria-hidden="true"></div>
            </div>
        </div>
    </div>

    <!-- ========== WATCHED ========== -->
    <div class="accordion-item"
         aria-labelledby="watched-header">

        <!-- Accordion Header -->
        <button class="accordion-header"
                id="watched-header"
                role="button"
                aria-expanded="false"
                aria-controls="watched-content"
                tabindex="0">
            üçø Watched
        </button>

        <div class="accordion-content"
             id="watched-content"
             role="region"
             aria-labelledby="watched-header">

            <div class="shelf-wrapper watched-wrapper" role="list" aria-label="Watched movies">

                <div class="scroll-left" aria-hidden="true"></div>

                <div class="shelf-row watched-row">

                    {% for movie in watched %}
                    <div class="shelf-card watched-card" role="listitem">

                        <img 
                            src="{{ movie.poster_url|default:'' }}" 
                            onerror="this.src='{% static 'images/movie-poster-unavailable.jpg' %}'" 
                            alt="{{ movie.title }} poster">

                        <div class="shelf-title" aria-label="Movie title: {{ movie.title }}">
                            {{ movie.title }}
                        </div>

                        <!-- Like / Dislike Buttons -->
                        <div class="rating-actions" aria-label="Rating options for {{ movie.title }}">

                            <!-- Thumbs Up -->
                            <form method="post" action="{% url 'thumb_up' movie.id %}"
                                  aria-label="Give {{ movie.title }} a thumbs up">
                                {% csrf_token %}
                                <button class="rating-btn up {% if movie.rating == 'up' %}active{% endif %}"
                                        aria-pressed="{% if movie.rating == 'up' %}true{% else %}false{% endif %}">
                                    <img src="{% static 'icons/thumb-up-solid.svg' %}" alt="Thumbs up icon">
                                </button>
                            </form>
                            
                            <!-- Thumbs Down -->
                            <form method="post" action="{% url 'thumb_down' movie.id %}"
                                  aria-label="Give {{ movie.title }} a thumbs down">
                                {% csrf_token %}
                                <button class="rating-btn down {% if movie.rating == 'down' %}active{% endif %}"
                                        aria-pressed="{% if movie.rating == 'down' %}true{% else %}false{% endif %}">
                                    <img src="{% static 'icons/thumb-down-solid.svg' %}" alt="Thumbs down icon">
                                </button>
                            </form>

                        </div>

                        <div class="shelf-actions" aria-label="Shelf actions for {{ movie.title }}">

                            <form action="{% url 'change_status' movie.id 'to_watch' %}" method="post"
                                  aria-label="Move {{ movie.title }} to your To Watch shelf">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline w-100">üîÑ To Watch</button>
                            </form>

                            <form action="{% url 'remove_movie' movie.id %}" method="post"
                                  aria-label="Remove {{ movie.title }} from your shelf">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-danger w-100">üóëÔ∏è Remove</button>
                            </form>
                        </div>
                    </div>

                    {% empty %}
                    <div class="empty-shelf-message" role="note">
                        üçø No watched movies yet.<br>
                        Go enjoy something!
                    </div>
                    {% endfor %}
                </div>

                <div class="scroll-right" aria-hidden="true"></div>
            </div>
        </div>
    </div>

</div>

{% endblock %}
