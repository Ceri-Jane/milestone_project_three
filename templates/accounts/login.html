{% extends "base.html" %}
{% load static %}
{% block content %}

{# ------------------------------------------------------------ #}
{#  LOGIN PAGE                                                  #}
{#  - Supports login via username OR email                      #}
{#  - Displays Django form-level auth errors correctly          #}
{#  - Adds inline field errors for accessibility                #}
{#  - Password eye toggle handled via auth.js                   #}
{#  - Browser validation enabled (no 'novalidate')              #}
{# ------------------------------------------------------------ #}

<div class="auth-wrapper" role="region" aria-labelledby="login-title">
    <div class="auth-card">

        <!-- Title used by both visual users and screen readers -->
        <h1 class="auth-title" id="login-title">Welcome Back ðŸŽ¬</h1>

        {# ------------------------------------------------------------ #}
        {# GLOBAL FORM ERRORS                                           #}
        {# Shown when login fails (wrong password, unknown user, etc.)  #}
        {# Django stores these in form.non_field_errors, not messages.  #}
        {# ------------------------------------------------------------ #}
        {% if form.non_field_errors %}
        <div class="alert alert-danger"
             role="alert"
             aria-live="assertive">
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        <!-- Login form wrapper with ARIA label for screen readers -->
        <form method="POST" aria-label="Login form">
            {% csrf_token %}

            {# ------------------------------------------------------------ #}
            {# IDENTIFIER FIELD (USERNAME OR EMAIL)                         #}
            {# Custom field added in LoginForm (identifier replaces         #}
            {# Django's default username field).                            #}
            {# ------------------------------------------------------------ #}
            <div class="form-group mb-3">
                <label for="id_identifier" class="form-label">
                    Username or Email
                </label>

                <input
                    type="text"
                    name="identifier"
                    id="id_identifier"
                    class="form-control {% if form.identifier.errors %}is-invalid{% endif %}"
                    placeholder="Enter username or email"
                    required
                    aria-required="true"
                    aria-invalid="{% if form.identifier.errors %}true{% else %}false{% endif %}"
                    value="{{ form.identifier.value|default:'' }}"
                >

                {% if form.identifier.errors %}
                <div class="invalid-feedback"
                     role="alert"
                     aria-live="assertive">
                    {{ form.identifier.errors.0 }}
                </div>
                {% endif %}
            </div>

            {# ------------------------------------------------------------ #}
            {# PASSWORD FIELD                                               #}
            {# Includes eye icon toggle via auth.js for better UX           #}
            {# ------------------------------------------------------------ #}
            <div class="form-group mb-3">
                <label for="id_password" class="form-label">Password</label>

                <div class="password-row">
                    <input
                        type="password"
                        name="password"
                        id="id_password"
                        class="form-control {% if form.password.errors %}is-invalid{% endif %}"
                        placeholder="Enter your password"
                        required
                        aria-required="true"
                        aria-invalid="{% if form.password.errors %}true{% else %}false{% endif %}"
                    >

                    <!-- Eye icon toggle made keyboard-accessible & screen-reader friendly -->
                    <svg class="password-toggle"
                         role="button"
                         tabindex="0"
                         aria-label="Toggle password visibility"
                         onclick="togglePassword('id_password')"
                         onkeypress="if(event.key === 'Enter'){ togglePassword('id_password') }"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="white"
                         stroke-width="2">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </div>

                {% if form.password.errors %}
                <div class="invalid-feedback d-block"
                     role="alert"
                     aria-live="assertive">
                    {{ form.password.errors.0 }}
                </div>
                {% endif %}
            </div>

            {# Submit Button #}
            <button type="submit"
                    class="btn btn-outline w-100 mt-2"
                    aria-label="Log in to your account">
                Log In
            </button>

            {# Forgot Password Link #}
            <div class="text-center mt-2">
                <a href="{% url 'password_reset' %}"
                   class="forgot-link"
                   aria-label="Reset your password">
                    Forgot password?
                </a>
            </div>

            {# Redirect to Signup #}
            <p class="auth-alt-text mt-3">
                Donâ€™t have an account?
                <a href="{% url 'signup' %}"
                   aria-label="Sign up for a new account">
                    Sign up
                </a>
            </p>

        </form>
    </div>
</div>

{% endblock %}
