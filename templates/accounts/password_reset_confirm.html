{% extends "base.html" %}

{# Page-specific SEO overrides: custom title + meta tags #}

{% block title %}
<title>QuickFlicks | Reset Password</title>
{% endblock %}

{% block meta_description %}
<meta name="description" content="Reset your QuickFlicks password securely using your personalised reset link.">
{% endblock %}

{% block meta_keywords %}
<meta name="keywords" content="quickflicks reset password, update password, secure login">
{% endblock %}

{% block content %}

<!-- ============================================================= -->
<!-- PASSWORD RESET (STEP 3) ‚Äì SET A NEW PASSWORD                  -->
<!-- Django provides `validlink` to detect expired/invalid tokens. -->
<!-- ============================================================= -->

<!-- Region landmark for assistive technologies -->
<div class="auth-wrapper" role="region" aria-labelledby="reset-password-title">
    <div class="auth-card">

        <!-- Page title for both visual and screen-reader users -->
        <h1 class="auth-title" id="reset-password-title">Choose a New Password üîê</h1>

        {% if validlink %}

            <!-- Form for setting a new password after validating the token -->
            <form method="POST" aria-label="Set a new password form">
                {% csrf_token %}

                <!-- New Password -->
                <div class="form-group mb-3">
                    {{ form.new_password1.label_tag }}

                    <div class="password-row">
                        {{ form.new_password1 }}

                        <!-- Password visibility toggle with ARIA + keyboard support -->
                        <svg class="password-toggle"
                        role="button"
                        tabindex="0"
                        aria-label="Toggle password visibility"
                        aria-pressed="false"
                        viewBox="0 0 24 24">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                        <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                </div>

                <!-- Confirm New Password -->
                <div class="form-group mb-3">
                    {{ form.new_password2.label_tag }}

                    <div class="password-row">
                        {{ form.new_password2 }}

                        <!-- Password visibility toggle for confirmation field -->
                        <svg class="password-toggle"
                        role="button"
                        tabindex="0"
                        aria-label="Toggle password visibility"
                        aria-pressed="false"
                        viewBox="0 0 24 24">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                        <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                </div>

                <!-- Submit updated password -->
                <button type="submit"
                        class="btn btn-outline w-100"
                        aria-label="Update your password">
                    Update Password
                </button>
            </form>

        {% else %}

            <!-- Invalid or expired reset link -->
            <p class="text-center" style="opacity:0.9; margin-top:10px;" 
               role="alert" aria-live="assertive">
                This password reset link is invalid or has already been used.<br>
                Please request a new reset email.
            </p>

        {% endif %}
    </div>
</div>

{% endblock %}
